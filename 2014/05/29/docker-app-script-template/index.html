<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <title>BetaCZ.com - 一个管理Docker应用程序的脚本模板</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="BetaCZ.com - 慢半拍" />
    <meta name="author" content="Beta CZ" />
    <meta charset="UTF-8" />
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="shortcut icon" type="image/png" href="/favicon.gif"/>
    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Roboto+Slab' rel='stylesheet' type='text/css'>
      <link href="/stylesheets/bootstrap.min.css" rel="stylesheet" />
      <link href="/stylesheets/syntax-dark.css" rel="stylesheet" />
      <link href="/stylesheets/main.css" rel="stylesheet"/>
       <link href="/stylesheets/googlesearch_fix.css" rel="stylesheet"/>
      <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-48462264-2', 'betacz.com');
      ga('send', 'pageview');
      </script>
    </head>
    <body>
      <nav class="navbar navbar-inverse" role="navigation">
        <div class='container'>
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <a class="navbar-brand" href="/">Beta CZ 的烂笔头</a>
          </div>
          <!-- Collect the nav links, forms, and other content for toggling -->
          <ul class="nav navbar-nav ">
            <li><a href="/about.html">关于我</a></li>
            <li><a href="/cats_and_tags.html#categories">分类</a></li>
            <li><a href="/cats_and_tags.html#tags">标签</a></li>
            <li><a href="/series">专题</a></li>
            <li><a href="/archives.html">归档</a></li>
          </ul>
          <form class="navbar-form navbar-right navbar-search" role="search">
            <div class="form-group">
              <input type="text" class="form-control search-query" placeholder="搜索">
            </div>
            <button type="submit" class="nav-search "><span class="glyphicon glyphicon-search"></span></button>
          </form>
          <ul class="nav navbar-nav  hidden-sm">
            <li><a href="/atom.xml" title='订阅' target="_blank"><i class="icon-rss"></i></a></li>
          </ul>
        </div>
      </nav>
      <div class='container'>
        <div class="row">
	<div class="col-lg-12" id="content">
		<article class="page">
	<div class="page-header">
		<h2 class="entry-title"><a href="/2014/05/29/docker-app-script-template/">一个管理Docker应用程序的脚本模板</a>
			<small>
				<span class="entry-date">2014-05-29</span>
			</small>
		</h2>
	</div>

	<div class="article-body">
		<div class="row">
			<div class="col-lg-12">
				<div class="article-body">
					<p>这是一个用于管理使用Docker打包的应用程序的脚本。通过包装docker命令，提供了特定应用程序的启动、停止、删除等管理功能。通过修改几个变量值，可以很容易的适配各类应用。</p>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh"><span class="c">#! /bin/bash -</span>

<span class="c">#####################################################</span>
<span class="c"># 此文件为Docker容器管理脚本模板,可自由使用与传播.</span>
<span class="c"># 请根据具体的应用程序作相应修改</span>
<span class="c"># 如有疑问，请联系: Beta CZ &lt;hlj8080@gmail.com&gt;</span>
<span class="c">#####################################################</span>

<span class="c"># 应用程序配置，按需修改</span>
<span class="nv">imagename</span><span class="o">=</span>dockerfile/redis
<span class="nv">container_name</span><span class="o">=</span>redis_db
<span class="nv">start_cmd</span><span class="o">=</span><span class="s2">&quot;docker run -d -p 6379:6379 --name ${container_name} ${imagename}&quot;</span>

<span class="c"># 获取容器状态命令, 除非Docker命令有变化，否则无需更改</span>
<span class="nv">container</span><span class="o">=(</span><span class="sb">`</span>docker ps <span class="p">|</span> grep <span class="k">${</span><span class="nv">container_name</span><span class="k">}</span><span class="sb">`</span><span class="o">)</span>
<span class="nv">container_stopped</span><span class="o">=(</span><span class="sb">`</span>docker ps -a <span class="p">|</span> grep <span class="k">${</span><span class="nv">container_name</span><span class="k">}</span><span class="sb">`</span><span class="o">)</span>

<span class="c"># 以下内容只在必要时才能更改,并确保清楚其后果.</span>
usage<span class="o">()</span>
<span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">&quot; * Usage: $0 {start|stop|kill|remove|status}&quot;</span>
  <span class="nb">exit </span>255
<span class="o">}</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span>-ne 1 <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="k">  </span>usage
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$1</span> !<span class="o">=</span> <span class="s2">&quot;start&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> -z <span class="nv">$container</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> -z <span class="nv">$container_stopped</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;ERROR：容器 ${container_name} 不存在.&quot;</span>
  <span class="nb">exit </span>255
<span class="k">fi </span>

<span class="k">case</span> <span class="nv">$1</span> in
start<span class="o">)</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$container</span> <span class="o">]</span>
  <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;${container_name} 应用正在运行中,请不要重复运行!&quot;</span>
    <span class="nb">exit </span>255
  <span class="k">fi</span>

<span class="k">  if</span> <span class="o">[</span> <span class="nv">$container_stopped</span> <span class="o">]</span>
  <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;${container_name} 已经停止，现在重新启动...&quot;</span>
    docker start <span class="k">${</span><span class="nv">container_name</span><span class="k">}</span>
  <span class="k">else</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;${container_name} 开始启动...&quot;</span>
    <span class="nv">container_id</span><span class="o">=(</span><span class="sb">`</span><span class="k">${</span><span class="nv">start_cmd</span><span class="k">}</span><span class="sb">`</span><span class="o">)</span>
  <span class="k">fi</span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;启动完成,应用名称为:${container_name},ID为:${container_id}&quot;</span>
  <span class="p">;;</span>
stop<span class="o">)</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$container</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="k">    </span>docker stop <span class="k">${</span><span class="nv">container_name</span><span class="k">}</span>
    <span class="nb">echo</span> <span class="s2">&quot;停止 ${container_name} 已完成.&quot;</span>  
  <span class="k">elif</span> <span class="o">[</span> <span class="nv">$container_stopped</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;${container_name} 当前已经处于停止状态，操作无效.&quot;</span>
  <span class="k">fi</span>
  <span class="p">;;</span>
<span class="nb">kill</span><span class="o">)</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$container</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="k">    </span>docker <span class="nb">kill</span> <span class="k">${</span><span class="nv">container_name</span><span class="k">}</span>
    <span class="nb">echo</span> <span class="s2">&quot;杀死 ${container_name} 已完成.&quot;</span>  
  <span class="k">elif</span> <span class="o">[</span> <span class="nv">$container_stopped</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;${container_name} 当前已经处于停止状态，操作无效.&quot;</span>
  <span class="k">fi</span>
  <span class="p">;;</span>
remove<span class="o">)</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$container</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;${container_name} 正在运行中，无法删除。&quot;</span>
    <span class="nb">exit </span>255
  <span class="k">elif</span> <span class="o">[</span> <span class="nv">$container_stopped</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="k">    </span>docker rm <span class="k">${</span><span class="nv">container_name</span><span class="k">}</span>
    <span class="nb">echo</span> <span class="s2">&quot;删除 ${container_name} 已完成.&quot;</span>
  <span class="k">fi</span>
  <span class="p">;;</span>
status<span class="o">)</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$container</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;${container_name} 正在运行中.&quot;</span>
  <span class="k">elif</span> <span class="o">[</span> <span class="nv">$container_stopped</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;${container_name} 容器已创建，但处于停止状态。&quot;</span>
  <span class="k">else</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;${container_name} 容器未找到！&quot;</span>
  <span class="k">fi</span>
  <span class="p">;;</span>
*<span class="o">)</span>
  usag
  <span class="p">;;</span>
<span class="k">esac</span>
<span class="nb">exit </span>0
</code></pre></div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-5 col-lg-offset-7">
				
				<div class="post-details">
	分类:
		
			
				<a href="/category/脚本技术"><span class="label label-default">脚本技术</span></a>
			
		
	|
	标签:
		
			
				<a href="/tag/Docker"><span class="label label-default">Docker</span></a>
			
				<a href="/tag/Shell脚本"><span class="label label-default">Shell脚本</span></a>
			
		
	|
	<a href="http://betacz.com/2014/05/29/docker-app-script-template/"><span class="label label-info">Permalink</span></a>
</div>



			</div>
		</div>
		<div class="row">
			<div class="col-lg-12">
				 <div id="disqus_thread"></div>
			    <script type="text/javascript">
			        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
			        var disqus_shortname = 'betacz-blog'; // required: replace example with your forum shortname

			        /* * * DON'T EDIT BELOW THIS LINE * * */
			        (function() {
			            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			        })();
			    </script>
			    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</div>
	</div>
</article>

	</div>
</div>

      </div>
      <footer class="rjfooter">
        <div class="container">
          <div class="row">
            <div class="col-lg-6 col-lg-offset-3">
              <p>&copy 2014.04 - Beta CZ ::: Hosted by <a href="https://pages.github.com/">GitHub Pages</a></p>
              <p class="disclaimer">
              <small>
              <strong>免责声明:</strong> 此站为个人站点，本站内容除特别注明外均为本人原创。文章内容仅代表个人观点，
              与本人所属公司或组织无关。其他组织或个人也无权主张本站所有内容的版权。
              </small>
              </p>
            </div>
          </div>
        </div>
      </footer>
      <script type="text/javascript" src="/js/jquery-2.0.3.min.js"></script>
      <script type="text/javascript" src="/js/bootstrap.min.js"></script>
      <script type="text/javascript">
      $('.search-query').keypress(function (e) {
        if (e.which == 13) {
          $(this).closest('form').submit();
          return false;  
        }
      });
      $('.navbar-search').on('submit', function(){
        var url =  '/search.html?q=' + $('.search-query').val();
        window.location.href=url;
        return false;
      })
      </script>
    </body>
  </html>